name: Generate Contributor Badge

on:
  schedule:
    # 每天执行一次
    - cron: '0 0 * * *'

jobs:
  generate-badge:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Generate Contributor List
      run: |
        # 使用git shortlog命令生成贡献者列表
        CONTRIBUTORS=$(git shortlog -s -n)
        echo "contributors=$CONTRIBUTORS" >> $GITHUB_ENV
    - name: Create Badge
      uses: schneidmaster/github-contributor-badge@v1
      with:
        CONTRIBUTORS: ${{ env.CONTRIBUTORS }}
        SVG_PATH: ./contributor-badge.svg
    - name: Commit & Push Badge
      run: |
        git config --global user.name 'github-actions[bot]'
        git config --global user.email 'github-actions[bot]@users.noreply.github.com'
        git add contributor-badge.svg
        git commit -m "Update contributor badge" || true
        git push
